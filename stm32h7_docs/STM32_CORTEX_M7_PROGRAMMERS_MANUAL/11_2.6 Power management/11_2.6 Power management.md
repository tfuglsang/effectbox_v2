# **2.6 Power management**

The CortexÂ®-M7 processor sleep modes reduce power consumption:

- Sleep mode stops the processor clock.
- Deep sleep mode stops the system clock and switches off the PLL and the Flash memory.

The SLEEPDEEP bit of the SCR selects which sleep mode is used, see *System control register on page 199*.

For more information about the behavior of the sleep modes see specific STM32 product referene manual.

This section describes the mechanisms for entering sleep mode, and the conditions for waking up from sleep mode.

### **2.6.1 Entering sleep mode**

This section describes the mechanisms software can use to put the processor into sleep mode.

The system can generate spurious wakeup events, for example a debug operation wakes up the processor. Therefore software must be able to put the processor back into sleep mode after such an event. A program might have an idle loop to put the processor back to sleep mode.

#### **Wait for interrupt**

The *wait for interrupt* instruction, WFI, causes immediate entry to sleep mode unless the wakeup condition is true, see *[Wakeup from WFI or sleep-on-exit on page](#page-1-0) 51*. When the processor executes a WFI instruction it stops executing instructions and enters sleep mode. See *WFI on page 182* for more information.

#### <span id="page-0-0"></span>**Wait for event**

The *wait for event* instruction, WFE, causes entry to sleep mode depending on the value of a one-bit event register. When the processor executes a WFE instruction, it checks the value of the event register:

- 0: The processor stops executing instructions and enters sleep mode.
- 1: The processor clears the register to 0 and continues executing instructions without entering sleep mode.

See *WFE on page 181* for more information.

If the event register is 1, this indicates that the processor must not enter sleep mode on execution of a WFE instruction. Typically, this is because an external event signal is asserted, or a processor in the system has executed an SEV instruction, see *SEV on page 180*. Software cannot access this register directly.

#### **Sleep-on-exit**

If the SLEEPONEXIT bit of the SCR is set to 1, when the processor completes the execution of all exception handlers it returns to Thread mode and immediately enters sleep mode. Use this mechanism in applications that only require the processor to run when an exception occurs.

50/254 PM0253 Rev 5

![](_page_0_Picture_23.jpeg)

### **2.6.2 Wakeup from sleep mode**

The conditions for the processor to wakeup depend on the mechanism that cause it to enter sleep mode.

### <span id="page-1-0"></span>**Wakeup from WFI or sleep-on-exit**

Normally, the processor wakes up only when it detects an exception with sufficient priority to cause exception entry. Some embedded systems might have to execute system restore tasks after the processor wakes up, and before it executes an interrupt handler. To achieve this set the PRIMASK bit to 1 and the FAULTMASK bit to 0. If an interrupt arrives that is enabled and has a higher priority than the current exception priority, the processor wakes up but does not execute the interrupt handler until the processor sets PRIMASK to zero. For more information about PRIMASK and FAULTMASK see *Exception mask registers on page 25*.

### **Wakeup from WFE**

The processor wakes up if:

- It detects an exception with sufficient priority to cause exception entry.
- It detects an external event signal, see *[The external event input](#page-1-1)*.
- In a multiprocessor system, another processor in the system executes an SEV instruction.

In addition, if the SEVONPEND bit in the SCR is set to 1, any new pending interrupt triggers an event and wakes up the processor, even if the interrupt is disabled or has insufficient priority to cause exception entry. For more information about the SCR see *System control register on page 199*.

# <span id="page-1-1"></span>**2.6.3 The external event input**

The processor provides an external event input signal. Peripherals can drive this signal, either to wake the processor from WFE, or to set the internal WFE event register to one to indicate that the processor must not enter sleep mode on a later WFE instruction. See *[Wait](#page-0-0)  [for event on page](#page-0-0) 50* for more information.

# **2.6.4 Power management programming hints**

ISO/IEC C cannot directly generate the WFI and WFE instructions. The CMSIS provides the following functions for these instructions:

```
void __WFE(void) // Wait for Event
void __WFI(void) // Wait for Interrupt
```

![](_page_1_Picture_17.jpeg)

PM0253 Rev 5 51/254