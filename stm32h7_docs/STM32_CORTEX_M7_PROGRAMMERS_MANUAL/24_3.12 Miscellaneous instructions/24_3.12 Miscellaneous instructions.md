# **Condition flags**

These instructions do not change the flags.

# **3.12 Miscellaneous instructions**

*[Table](#page-0-0) 38* shows the remaining CortexÂ®-M7 instructions:

**Table 38. Miscellaneous instructions** 

<span id="page-0-0"></span>

| Mnemonic | Brief description                          | See              |
|----------|--------------------------------------------|------------------|
| BKPT     | Breakpoint                                 | BKPT on page 175 |
| CPSID    | Change Processor State, Disable Interrupts | CPS on page 176  |
| CPSIE    | Change Processor State, Enable Interrupts  | CPS on page 176  |
| DMB      | Data Memory Barrier                        | DMB on page 177  |
| DSB      | Data Synchronization Barrier               | DSB on page 177  |
| ISB      | Instruction Synchronization Barrier        | ISB on page 178  |
| MRS      | Move from special register to register     | MRS on page 178  |
| MSR      | Move from register to special register     | MSR on page 179  |
| NOP      | No Operation                               | NOP on page 180  |
| SEV      | Send Event                                 | SEV on page 180  |
| SVC      | Supervisor Call                            | SVC on page 181  |
| WFE      | Wait For Event                             | WFE on page 181  |
| WFI      | Wait For Interrupt                         | WFI on page 182  |

# <span id="page-0-1"></span>**3.12.1 BKPT**

Breakpoint.

## **Syntax**

BKPT #*imm*

Where:

*imm* Is an expression evaluating to an integer in the range 0-255 (8-bit value).

## **Operation**

The BKPT instruction causes the processor to enter Debug state. Debug tools can use this to investigate system state when the instruction at a particular address is reached.

*imm* is ignored by the processor. If required, a debugger can use it to store additional information about the breakpoint.

The BKPT instruction can be placed inside an IT block, but it executes unconditionally, unaffected by the condition specified by the IT instruction.

![](_page_0_Picture_18.jpeg)

PM0253 Rev 5 175/254

## **Condition flags**

This instruction does not change the flags.

## **Examples**

```
BKPT #0x3 ; Breakpoint with immediate value set to 0x3 (debugger can
            ; extract the immediate value by locating it using the PC)
```

Arm does not recommend the use of the BKPT instruction with an immediate value set to 0xAB for any purpose other than Semi-hosting.

# <span id="page-1-0"></span>**3.12.2 CPS**

Change Processor State.

## **Syntax**

```
CPSeffect iflags
Where:
effect Is one of:
          IE Clears the special purpose register.
          ID Sets the special purpose register.
iflags Is a sequence of one or more flags:
          i Set or clear PRIMASK.
          f Set or clear FAULTMASK.
```

## **Operation**

CPS changes the PRIMASK and FAULTMASK special register values. See *Exception mask registers on page 25* for more information about these registers.

# **Restrictions**

The restrictions are:

- Use CPS only from privileged software. It has no effect if used in unprivileged software.
- CPS cannot be conditional and so must not be used inside an IT block.

# **Condition flags**

This instruction does not change the condition flags.

## **Examples**

```
CPSID i ; Disable interrupts and configurable fault handlers (set 
         ; PRIMASK)
CPSID f ; Disable interrupts and all fault handlers (set FAULTMASK)
CPSIE i ; Enable interrupts and configurable fault handlers (clear 
         ; PRIMASK)
CPSIE f ; Enable interrupts and fault handlers (clear FAULTMASK)
```

176/254 PM0253 Rev 5

![](_page_1_Picture_22.jpeg)

# <span id="page-2-0"></span>**3.12.3 DMB**

Data Memory Barrier.

## **Syntax**

DMB{*cond*}

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

DMB acts as a data memory barrier. It ensures that all explicit memory accesses that appear, in program order, before the DMB instruction are completed before any explicit memory accesses that appear, in program order, after the DMB instruction. DMB does not affect the ordering or execution of instructions that do not access memory.

## **Condition flags**

This instruction does not change the flags.

#### **Examples**

```
DMB ; Data Memory Barrier
```

## <span id="page-2-1"></span>**3.12.4 DSB**

Data Synchronization Barrier.

## **Syntax**

DSB{*cond*}

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

DSB acts as a special data synchronization memory barrier. Instructions that come after the DSB, in program order, do not execute until the DSB instruction completes. The DSB instruction completes when all explicit memory accesses before it complete.

## **Condition flags**

This instruction does not change the flags.

## **Examples**

DSB ; Data Synchronisation Barrier

![](_page_2_Picture_26.jpeg)

PM0253 Rev 5 177/254

# <span id="page-3-0"></span>**3.12.5 ISB**

Instruction Synchronization Barrier.

## **Syntax**

ISB{*cond*}

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

ISB acts as an instruction synchronization barrier. It flushes the pipeline of the processor, so that all instructions following the ISB are fetched from cache or memory again, after the ISB instruction has been completed.

## **Condition flags**

This instruction does not change the flags.

# **Examples**

ISB ; Instruction Synchronisation Barrier

## <span id="page-3-1"></span>**3.12.6 MRS**

Move the contents of a special register to a general-purpose register.

## **Syntax**

MRS{*cond*} *Rd*, *spec\_reg*

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

*Rd* Is the destination register.

*spec\_reg* Can be any of: APSR, IPSR, EPSR, IEPSR, IAPSR, EAPSR, PSR, MSP, PSP, PRIMASK,

BASEPRI, BASEPRI\_MAX, FAULTMASK, or CONTROL.

All the EPSR and IPSR fields are zero when read by the MRS instruction.

## **Operation**

Use MRS in combination with MSR as part of a read-modify-write sequence for updating a PSR, for example to clear the Q flag.

In process swap code, the programmers model state of the process being swapped out must be saved, including relevant PSR contents. Similarly, the state of the process being swapped in must also be restored. These operations use MRS in the state-saving instruction sequence and MSR in the state-restoring instruction sequence.

BASEPRI\_MAX is an alias of BASEPRI when used with the MRS instruction.

See *[MSR on page](#page-4-0) 179*.

![](_page_3_Picture_29.jpeg)

178/254 PM0253 Rev 5

## **Restrictions**

*Rd* must not be SP and must not be PC.

## **Condition flags**

This instruction does not change the flags.

## **Examples**

```
MRS R0, PRIMASK ; Read PRIMASK value and write it to R0
```

## <span id="page-4-0"></span>**3.12.7 MSR**

Move the contents of a general-purpose register into the specified special register.

## **Syntax**

```
MSR{cond} spec_reg, Rn
```

## Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

*Rn* Is the source register.

*spec\_reg* Can be any of: APSR\_nzcvq, APSR\_g, APSR\_nzcvqg, MSP, PSP, PRIMASK,

BASEPRI, BASEPRI\_MAX, FAULTMASK, or CONTROL.

APSR can be used to refer to APSR\_nzcvq.

## **Operation**

The register access operation in MSR depends on the privilege level. Unprivileged software can only access the APSR, see *Table 4 on page 23*. Privileged software can access all special registers.

In unprivileged software writes to unallocated or execution state bits in the PSR are ignored.

When writing to BASEPRI\_MAX, the instruction writes to BASEPRI only if either:

- *Rn* is non-zero and the current BASEPRI value is 0.
- *Rn* is non-zero and less than the current BASEPRI value.

See *[MRS on page](#page-3-1) 178*.

## **Restrictions**

*Rn* must not be SP and must not be PC.

## **Condition flags**

This instruction updates the flags explicitly based on the value in *Rn*.

## **Examples**

MSR CONTROL, R1 ; Read R1 value and write it to the CONTROL register

![](_page_4_Picture_31.jpeg)

PM0253 Rev 5 179/254

# <span id="page-5-1"></span>**3.12.8 NOP**

No Operation.

## **Syntax**

NOP{*cond*}

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

NOP does nothing. NOP is not necessarily a time-consuming NOP. The processor might remove it from the pipeline before it reaches the execution stage.

Use NOP for padding, for example to place the following instruction on a 64-bit boundary.

## **Condition flags**

This instruction does not change the flags.

## **Examples**

```
NOP ; No operation
```

## <span id="page-5-0"></span>**3.12.9 SEV**

Send Event.

## **Syntax**

SEV{*cond*}

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

SEV is a hint instruction that causes an event to be signaled to all processors within a multiprocessor system. It also sets the local event register to 1, see *Power management on page 50*.

## **Condition flags**

This instruction does not change the flags.

## **Examples**

```
SEV ; Send Event
```

180/254 PM0253 Rev 5

# <span id="page-6-0"></span>**3.12.10 SVC**

Supervisor Call.

# **Syntax**

```
SVC{cond} #imm
```

#### Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*. *imm* Is an expression evaluating to an integer in the range 0-255 (8-bit value).

## **Operation**

The SVC instruction causes the SVC exception.

*imm* is ignored by the processor. If required, it can be retrieved by the exception handler to determine what service is being requested.

## **Condition flags**

This instruction does not change the flags.

# **Examples**

```
SVC #0x32 ; Supervisor Call (SVCall handler can extract the immediate 
           ; value by locating it through the stacked PC)
```

# <span id="page-6-1"></span>**3.12.11 WFE**

Wait For Event.

## **Syntax**

WFE{*cond*}

## Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

WFE is a hint instruction.

If the event register is 0, WFE suspends execution until one of the following events occurs:

- An exception, unless masked by the exception mask registers or the current priority level.
- An exception enters the Pending state, if SEVONPEND in the System Control register is set.
- A Debug Entry request, if Debug is enabled.
- An event signaled by a peripheral or another processor in a multiprocessor system using the SEV instruction.

If the event register is 1, WFE clears it to 0 and returns immediately.

For more information see *Power management on page 50*.

![](_page_6_Picture_30.jpeg)

PM0253 Rev 5 181/254

## **Condition flags**

This instruction does not change the flags.

## **Examples**

```
WFE ; Wait for event
```

# <span id="page-7-0"></span>**3.12.12 WFI**

Wait for Interrupt.

## **Syntax**

WFI{*cond*}

Where:

*cond* Is an optional condition code. See *Conditional execution on page 68*.

## **Operation**

WFI is a hint instruction that suspends execution until one of the following events occurs:

- A non-masked interrupt occurs and is taken.
- An interrupt masked by PRIMASK becomes pending.
- A Debug Entry request.

# **Condition flags**

This instruction does not change the flags.

## **Examples**

```
WFI ; Wait for interrupt
```

![](_page_7_Picture_21.jpeg)