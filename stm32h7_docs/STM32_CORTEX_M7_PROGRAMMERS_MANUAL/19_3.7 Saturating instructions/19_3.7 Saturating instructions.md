# **3.7 Saturating instructions**

*[Table](#page-0-0) 32* shows the saturating instructions:

**Table 32. Saturating instructions** 

<span id="page-0-0"></span>

| Mnemonic | Brief description                                     | See                           |
|----------|-------------------------------------------------------|-------------------------------|
| SSAT     | Signed Saturate                                       | SSAT and USAT on page 129     |
| SSAT16   | Signed Saturate Halfword                              | SSAT16 and USAT16 on page 130 |
| USAT     | Unsigned Saturate                                     | SSAT and USAT on page 129     |
| USAT16   | Unsigned Saturate Halfword                            | SSAT16 and USAT16 on page 130 |
| QADD     | Saturating Add                                        | QADD and QSUB on page 131     |
| QSUB     | Saturating Subtract                                   | QADD and QSUB on page 131     |
| QSUB16   | Saturating Subtract 16                                | QADD and QSUB on page 131     |
| QASX     | Saturating Add and Subtract with Exchange             | QASX and QSAX on page 132     |
| QSAX     | Saturating Subtract and Add with Exchange             | QASX and QSAX on page 132     |
| QDADD    | Saturating Double and Add                             | QDADD and QDSUB on page 133   |
| QDSUB    | Saturating Double and Subtract                        | QDADD and QDSUB on page 133   |
| UQADD16  | Unsigned Saturating Add 16                            | UQADD and UQSUB on page 136   |
| UQADD8   | Unsigned Saturating Add 8                             | UQADD and UQSUB on page 136   |
| UQASX    | Unsigned Saturating Add and Subtract with<br>Exchange | UQASX and UQSAX on page 134   |
| UQSAX    | Unsigned Saturating Subtract and Add with<br>Exchange | UQASX and UQSAX on page 134   |
| UQSUB16  | Unsigned Saturating Subtract 16                       | UQADD and UQSUB on page 136   |
| UQSUB8   | Unsigned Saturating Subtract 8                        | UQADD and UQSUB on page 136   |

For signed *n*-bit saturation, this means that:

- If the value to be saturated is less than -2*n*-*1*, the result returned is -2*n-1*
- If the value to be saturated is greater than 2*n*-*1*-1, the result returned is 2*n-1*-1
- Otherwise, the result returned is the same as the value to be saturated.

For unsigned *n*-bit saturation, this means that:

- If the value to be saturated is less than 0, the result returned is 0
- If the value to be saturated is greater than 2*n*-1, the result returned is 2*n*-1
- Otherwise, the result returned is the same as the value to be saturated.

If the returned result is different from the value to be saturated, it is called *saturation*. If the saturation occurs, the instruction sets the Q flag to 1 in the APSR. Otherwise, it leaves the Q flag unchanged. To clear the Q flag to 0, the MSR instruction must be used, see *MSR on page 179*.

To read the state of the Q flag, use the MRS instruction, see *MRS on page 178*.

![](_page_0_Picture_17.jpeg)

# <span id="page-1-0"></span>**3.7.1 SSAT and USAT**

Signed Saturate and Unsigned Saturate to any bit position, with optional shift before saturating.

### **Syntax**

```
op{cond} Rd, #n, Rm {, shift #s}
Where:
op Is one of:
           SSAT Saturates a signed value to a signed range.
           USAT Saturates a signed value to an unsigned range.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
n Specifies the bit position to saturate to:
           • n ranges from 1 to 32 for SSAT.
           • n ranges from 0 to 31 for USAT.
Rm Is the register containing the value to saturate.
shift #s Is an optional shift applied to Rm before saturating. It must be one of the 
           following:
           ASR #s where s is in the range 1 to 31.
           LSL #s where s is in the range 0 to 31.
```

### **Operation**

These instructions saturate to a signed or unsigned *n*-bit value.

The SSAT instruction applies the specified shift, then saturates to the signed range −2*n*–1 ≤*x* ≤2*n*–1−1.

The USAT instruction applies the specified shift, then saturates to the unsigned range 0 ≤*x* ≤2*n*−1.

# **Restrictions**

Do not use SP and do not use PC*.*

## **Condition flags**

These instructions do not affect the condition code flags.

If saturation occurs, these instructions set the Q flag to 1.

### **Examples**

```
SSAT R7, #16, R7, LSL #4 ; Logical shift left value in R7 by 4,
                           ; then saturate it as a signed 16-bit 
                           ; value and write it back to R7.
USATNE R0, #7, R5 ; Conditionally saturate value in R5 as a
                           ; an unsigned 7 bit value and write it to 
                           ; R0.
```

PM0253 Rev 5 129/254

# <span id="page-2-0"></span>**3.7.2 SSAT16 and USAT16**

Signed Saturate and Unsigned Saturate to any bit position for two halfwords.

# **Syntax**

```
op{cond} Rd, #n, Rm
Where:
op Is one of:
           SSAT16 Saturates a signed halfword value to a signed range.
           USAT16 Saturates a signed halfword value to an unsigned range.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
n Specifies the bit position to saturate to:
           • n ranges from 1 to 16 for SSAT.
           • n ranges from 0 to 15 for USAT.
Rm Is the register containing the value to saturate.
```

### **Operation**

The SSAT16 instruction:

- 1. Saturates two signed 16-bit halfword values of the register with the value to saturate from selected by the bit position in *n*.
- 2. Writes the results as two signed 16-bit halfwords to the destination register.

The USAT16 instruction:

- 1. Saturates two unsigned 16-bit halfword values of the register with the value to saturate from selected by the bit position in *n*.
- 2. Writes the results as two unsigned halfwords in the destination register.

### **Restrictions**

Do not use SP and do not use PC*.*

### **Condition flags**

These instructions do not affect the condition code flags.

If saturation occurs, these instructions set the Q flag to 1.

### **Examples**

```
SSAT16 R7, #9, R2 ; Saturates the top and bottom highwords of R2 
 ; as 9-bit values, writes to corresponding 
 ; halfword of R7.
USAT16NE R0, #13, R5 ; Conditionally saturates the top and bottom 
 ; halfwords of R5 as 13-bit values, writes to 
 ; corresponding halfword of R0.
```

![](_page_2_Picture_21.jpeg)

# <span id="page-3-0"></span>**3.7.3 QADD and QSUB**

Saturating Add and Saturating Subtract, signed.

## **Syntax**

```
op{cond} {Rd}, Rn, Rm
op{cond} {Rd}, Rn, Rm
Where:
op Is one of:
           QADD Saturating 32-bit add.
           QADD8 Saturating four 8-bit integer additions.
           QADD16 Saturating two 16-bit integer additions.
           QSUB Saturating 32-bit subtraction.
           QSUB8 Saturating four 8-bit integer subtraction.
           QSUB16 Saturating two 16-bit integer subtraction.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
Rn, Rm Are registers holding the first and second operands.
```

### **Operation**

These instructions add or subtract two, four or eight values from the first and second operands and then writes a signed saturated value in the destination register.

The QADD and QSUB instructions apply the specified add or subtract, and then saturate the result to the signed range −2*n*–1 ≤*x* ≤2*n*–1−1, where *x* is given by the number of bits applied in the instruction, 32, 16 or 8.

If the returned result is different from the value to be saturated, it is called *saturation*. If saturation occurs, the QADD and QSUB instructions set the Q flag to 1 in the APSR. Otherwise, it leaves the Q flag unchanged. The 8-bit and 16-bit QADD and QSUB instructions always leave the Q flag unchanged.

To clear the Q flag to 0, the MSR instruction must be used, see *MSR on page 179*.

To read the state of the Q flag, use the MRS instruction, see *MRS on page 178*.

### **Restrictions**

Do not use SP and do not use PC*.*

### **Condition flags**

These instructions do not affect the condition code flags.

If saturation occurs, these instructions set the Q flag to 1.

### **Examples**

```
QADD16 R7, R4, R2 ; Adds halfwords of R4 with corresponding halfword of
 ; R2, saturates to 16 bits and writes to 
 ; corresponding halfword of R7.
```

![](_page_3_Picture_19.jpeg)

PM0253 Rev 5 131/254

```
QADD8 R3, R1, R6 ; Adds bytes of R1 to the corresponding bytes of R6,
 ; saturates to 8 bits and writes to corresponding
 ; byte of R3.
QSUB16 R4, R2, R3 ; Subtracts halfwords of R3 from corresponding 
 ; halfword of R2, saturates to 16 bits, writes to
 ; corresponding halfword of R4.
QSUB8 R4, R2, R5 ; Subtracts bytes of R5 from the corresponding byte 
 ; in R2, saturates to 8 bits, writes to corresponding 
 ; byte of R4.
```

## <span id="page-4-0"></span>**3.7.4 QASX and QSAX**

Saturating Add and Subtract with Exchange and Saturating Subtract and Add with Exchange, signed.

## **Syntax**

```
op{cond} {Rd}, Rm, Rn
Where:
op Is one of:
           QASX Add and Subtract with Exchange and Saturate.
           QSAX Subtract and Add with Exchange and Saturate.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
Rn, Rm Are registers holding the first and second operands.
```

### **Operation**

The QASX instruction:

- 1. Adds the top halfword of the source operand with the bottom halfword of the second operand.
- 2. Subtracts the top halfword of the second operand from the bottom highword of the first operand.
- 3. Saturates the result of the subtraction and writes a 16-bit signed integer in the range 215 ≤ x ≤ 215 – 1, where *x* equals 16, to the bottom halfword of the destination register.
- 4. Saturates the results of the sum and writes a 16-bit signed integer in the range –215 ≤ x ≤ 215 – 1, where *x* equals 16, to the top halfword of the destination register.

#### The QSAX instruction:

- 1. Subtracts the bottom halfword of the second operand from the top highword of the first operand.
- 2. Adds the bottom halfword of the source operand with the top halfword of the second operand.
- 3. Saturates the results of the sum and writes a 16-bit signed integer in the range –215 ≤ x ≤ 215 – 1, where *x* equals 16, to the bottom halfword of the destination register.
- 4. Saturates the result of the subtraction and writes a 16-bit signed integer in the range 215 ≤ x ≤ 215 – 1, where *x* equals 16, to the top halfword of the destination register.

# **Restrictions**

Do not use SP and do not use PC*.*

![](_page_4_Picture_21.jpeg)

# **Condition flags**

These instructions do not affect the condition code flags.

## **Examples**

```
QASX R7, R4, R2 ; Adds top halfword of R4 to bottom halfword of R2,
 ; saturates to 16 bits, writes to top halfword of
 ; R7, Subtracts top highword of R2 from bottom
 ; halfword of R4, saturates to 16 bits and writes 
 ; to bottom halfword of R7
QSAX R0, R3, R5 ; Subtracts bottom halfword of R5 from top halfword 
 ; of R3, saturates to 16 bits, writes to top 
                 ; halfword of R0
 ; Adds bottom halfword of R3 to top halfword of R5,
 ; saturates to 16 bits, writes to bottom halfword 
                 ; of R0.
```

## <span id="page-5-0"></span>**3.7.5 QDADD and QDSUB**

Saturating Double and Add and Saturating Double and Subtract, signed.

### **Syntax**

```
op{cond} {Rd}, Rm, Rn
Where:
op Is one of:
           QDADD Saturating Double and Add.
           QDSUB Saturating Double and Subtract.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
Rm, Rn Are registers holding the first and second operands.
```

### **Operation**

The QDADD instruction:

- Doubles the second operand value.
- Adds the result of the doubling to the signed saturated value in the first operand.
- Writes the result to the destination register.

The QDSUB instruction:

- Doubles the second operand value.
- Subtracts the doubled value from the signed saturated value in the first operand.
- Writes the result to the destination register.

Both the doubling and the addition or subtraction have their results saturated to the 32-bit signed integer range –2<sup>31</sup> ≤ x ≤ 231– 1. If saturation occurs in either operation, it sets the Q flag in the APSR.

### **Restrictions**

Do not use SP and do not use PC*.*

![](_page_5_Picture_22.jpeg)

PM0253 Rev 5 133/254

# **Condition flags**

If saturation occurs, these instructions set the Q flag to 1.

## **Examples**

```
QDADD R7, R4, R2 ; Doubles and saturates R4 to 32 bits, adds R2,
                         ; Saturates to 32 bits, writes to R7
QDSUB R0, R3, R5 ; Subtracts R3 doubled and saturated to 32 bits 
                         ; from R5, saturates to 32 bits, writes to R0.
```

## <span id="page-6-0"></span>**3.7.6 UQASX and UQSAX**

Saturating Add and Subtract with Exchange and Saturating Subtract and Add with Exchange, unsigned.

### **Syntax**

```
op{cond} {Rd}, Rm, Rn
Where:
type Is one of:
           UQASX Add and Subtract with Exchange and Saturate.
           UQSAX Subtract and Add with Exchange and Saturate.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
```

*Rn*, *Rm* Are registers holding the first and second operands.

### **Operation**

# The UQASX instruction:

- 1. Adds the bottom halfword of the source operand with the top halfword of the second operand.
- 2. Subtracts the bottom halfword of the second operand from the top highword of the first operand.
- 3. Saturates the results of the sum and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the top halfword of the destination register.
- 4. Saturates the result of the subtraction and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the bottom halfword of the destination register.

#### The UQSAX instruction:

- 1. Subtracts the bottom halfword of the second operand from the top highword of the first operand.
- 2. Adds the bottom halfword of the first operand with the top halfword of the second operand.
- 3. Saturates the result of the subtraction and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the top halfword of the destination register.
- 4. Saturates the results of the addition and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the bottom halfword of the destination register.

![](_page_6_Picture_22.jpeg)

### **Restrictions**

Do not use SP and do not use PC*.*

## **Condition flags**

These instructions do not affect the condition code flags.

### **Examples**

```
UQASX R7, R4, R2 ; Adds top halfword of R4 with bottom halfword of R2, 
 ; saturates to 16 bits, writes to top halfword of R7
 ; Subtracts top halfword of R2 from bottom halfword of
 ; R4, saturates to 16 bits, writes to bottom halfword 
                ; of R7
UQSAX R0, R3, R5 ; Subtracts bottom halfword of R5 from top halfword of 
                ; R3, saturates to 16 bits, writes to top halfword of 
                ; R0
 ; Adds bottom halfword of R4 to top halfword of R5
 ; saturates to 16 bits, writes to bottom halfword of 
                ; R0.
```

![](_page_7_Picture_8.jpeg)

PM0253 Rev 5 135/254

# <span id="page-8-0"></span>**3.7.7 UQADD and UQSUB**

Saturating Add and Saturating Subtract Unsigned.

### **Syntax**

```
op{cond} {Rd}, Rn, Rm
op{cond} {Rd}, Rn, Rm
Where:
op Is one of:
           UQADD8 Saturating four unsigned 8-bit integer additions.
           UQADD16 Saturating two unsigned 16-bit integer additions.
           UDSUB8 Saturating four unsigned 8-bit integer subtractions.
           UQSUB16 Saturating two unsigned 16-bit integer subtractions.
cond Is an optional condition code. See Conditional execution on page 68.
Rd Is the destination register.
```

### **Operation**

These instructions add or subtract two or four values and then writes an unsigned saturated value in the destination register.

#### The UQADD16 instruction:

- Adds the respective top and bottom halfwords of the first and second operands.
- Saturates the result of the additions for each halfword in the destination register to the unsigned range 0 ≤*x* ≤ 216−1, where *x* is 16.

#### The UQADD8 instruction:

• Adds each respective byte of the first and second operands.

*Rn, Rm* Are registers holding the first and second operands.

• Saturates the result of the addition for each byte in the destination register to the unsigned range 0 ≤*x* ≤ 28−1, where *x* is 8.

### The UQSUB16 instruction:

- Subtracts both halfwords of the second operand from the respective halfwords of the first operand.
- Saturates the result of the differences in the destination register to the unsigned range 0 ≤*x* ≤ 216−1, where *x* is 16.

### The UQSUB8 instructions:

- Subtracts the respective bytes of the second operand from the respective bytes of the first operand.
- Saturates the results of the differences for each byte in the destination register to the unsigned range 0 ≤*x* ≤ 28−1, where *x* is 8.

## **Restrictions**

Do not use SP and do not use PC*.*

![](_page_8_Picture_23.jpeg)