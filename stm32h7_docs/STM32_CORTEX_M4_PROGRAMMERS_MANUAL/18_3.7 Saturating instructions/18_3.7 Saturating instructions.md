# **3.7 Saturating instructions**

This section describes the saturating instructions.

**Table 30. Saturating instructions**

| Mnemonic | Brief description                                  | See                           |
|----------|----------------------------------------------------|-------------------------------|
| SSAT     | Signed Saturate                                    | SSAT and USAT on page 126     |
| SSAT16   | Signed Saturate Halfword                           | SSAT16 and USAT16 on page 127 |
| USAT     | Unsigned Saturate                                  | SSAT and USAT on page 126     |
| USAT16   | Unsigned Saturate Halfword                         | SSAT16 and USAT16 on page 127 |
| QADD     | Saturating Add                                     | QADD and QSUB on page 128     |
| QSUB     | Saturating Subtract                                | QADD and QSUB on page 128     |
| QSUB16   | Saturating Subtract 16                             | QADD and QSUB on page 128     |
| QASX     | Saturating Add and Subtract with Exchange          | QASX and QSAX on page 129     |
| QSAX     | Saturating Subtract and Add with Exchange          | QASX and QSAX on page 129     |
| QDADD    | Saturating Double and Add                          | QDADD and QDSUB on page 130   |
| QDSUB    | Saturating Double and Subtract                     | QDADD and QDSUB on page 130   |
| UQADD16  | Unsigned Saturating Add 16                         | UQADD and UQSUB on page 132   |
| UQADD8   | Unsigned Saturating Add 8                          | UQADD and UQSUB on page 132   |
| UQASX    | Unsigned Saturating Add and Subtract with Exchange | UQASX and UQSAX on page 131   |
| UQSAX    | Unsigned Saturating Subtract and Add with Exchange | UQASX and UQSAX on page 131   |
| UQSUB16  | Unsigned Saturating Subtract 16                    | UQADD and UQSUB on page 132   |
| UQSUB8   | Unsigned Saturating Subtract 8                     | UQADD and UQSUB on page 132   |

For signed *n*-bit saturation, this means that:

- if the value to be saturated is less than *-2n-1*, the result returned is *-2n-1*
- if the value to be saturated is greater than *2n-1-1*, the result returned is *2n-1-1*
- otherwise, the result returned is the same as the value to be saturated.

For unsigned *n*-bit saturation, this means that:

- if the value to be saturated is less than 0, the result returned is 0
- if the value to be saturated is greater than *2n-1*, the result returned is *2n-1*
- otherwise, the result returned is the same as the value to be saturated.

If the returned result is different from the value to be saturated, it is called saturation. If saturation occurs, the instruction sets the Q flag to 1 in the APSR. Otherwise, it leaves the Q flag unchanged. To clear the Q flag to 0, you must use the MSR instruction, see *MSR on page 187*.

To read the state of the Q flag, use the MRS instruction, see *MRS on page 186*.

![](_page_0_Picture_16.jpeg)

PM0214 Rev 10 125/262

# <span id="page-1-0"></span>**3.7.1 SSAT and USAT**

Signed Saturate and Unsigned Saturate to any bit position, with optional shift before saturating.

## **Syntax**

```
op{cond} Rd, #n, Rm {, shift #s}
```

#### Where:

• *op'* is one of:

SSAT: Saturates a signed value to a signed range.

USAT: Saturates a signed value to an unsigned range.

- '*cond*' is an optional condition code (see *Conditional execution on page 65*).
- '*Rd*' is the destination register.
- '*n*' specifies the bit position to saturate to:

n ranges from 1 to 32 for SSAT

n ranges from 0 to 31 for USAT.

- '*Rm*' is the register containing the value to saturate.
- '*shift #s*' is an optional shift applied to *Rm* before saturating. It must be one of the following:

ASR #s: where s is in the range 1 to 31.

LSL #s: where s is in the range 0 to 31.

## **Operation**

These instructions saturate to a signed or unsigned n-bit value.

The SSAT instruction applies the specified shift, then saturates to the signed range *-2n–1* ≤ *x*  ≤ *2n–1-1*.

The USAT instruction applies the specified shift, then saturates to the unsigned range *0* ≤ *x*  ≤ *2n-1*.

## **Restrictions**

Do not use SP and do not use PC.

Condition flags

These instructions do not affect the condition code flags.

If saturation occurs, these instructions set the Q flag to 1.

## **Examples**

```
SSAT R7, #16, R7, LSL #4 ; Logical shift left value in R7 by 4, then 
                 ; saturate it as a signed 16-bit value and
                 ; write it back to R7
USATNE R0, #7, R5; Conditionally saturate value in R5 as an 
                 ; unsigned 7 bit value and write it to R0.
```

![](_page_1_Picture_31.jpeg)

# <span id="page-2-0"></span>**3.7.2 SSAT16 and USAT16**

Signed Saturate and Unsigned Saturate to any bit position for two halfwords.

## **Syntax**

```
op{cond} Rd, #n, Rm
Where:
```

• *op'* is one of:

SSAT16 Saturates a signed halfword value to a signed range.

USAT16 Saturates a signed halfword value to an unsigned range.

- '*cond*' is an optional condition code (see *Conditional execution on page 65*)
- '*Rd*' is the destination register.
- '*n*' specifies the bit position to saturate to:

n ranges from 1 to 16 for SSAT.

n ranges from 0 to 15 for USAT.

• '*Rm*' is the register containing the value to saturate.

## **Operation**

The SSAT16 instruction:

- 1. Saturates two signed 16-bit halfword values of the register with the value to saturate from selected by the bit position in *n*.
- 2. Writes the results as two signed 16-bit halfwords to the destination register.

The USAT16 instruction:

- 1. Saturates two unsigned 16-bit halfword values of the register with the value to saturate from selected by the bit position in *n*.
- 2. Writes the results as two unsigned halfwords in the destination register.

# **Restrictions**

Do not use SP and do not use PC.

Condition flags

These instructions do not affect the condition code flags.

If saturation occurs, these instructions set the Q flag to 1.

## **Examples**

```
SSAT16 R7, #9, R2 ; Saturates the top and bottom highwords of R2 
                       ; as 9-bit values, writes to corresponding halfword
                       ; of R7
USAT16NE R0, #13, R5 ; Conditionally saturates the top and bottom 
                       ; halfwords of R5 as 13-bit values, writes to 
                       ; corresponding halfword of R0.
```

PM0214 Rev 10 127/262

# <span id="page-3-0"></span>**3.7.3 QADD and QSUB**

Saturating Add and Saturating Subtract, signed.

## **Syntax**

```
op{cond} {Rd}, Rn, Rm
op{cond} {Rd}, Rn, Rm
```

#### Where:

• *op'* is one of:

QADD: Saturating 32-bit add.

QADD8: Saturating four 8-bit integer additions.

QADD16: Saturating two 16-bit integer additions.

QSUB: Saturating 32-bit subtraction.

QSUB8: Saturating four 8-bit integer subtraction.

QSUB16: Saturating two 16-bit integer subtraction.

- '*cond*' is an optional condition code (see *Conditional execution on page 65*)
- '*Rd*' is the destination register.
- '*Rn, Rm*' are registers holding the first and second operands.

## **Operation**

These instructions add or subtract two, four or eight values from the first and second operands and then write a signed saturated value in the destination register.

The QADD and QSUB instructions apply the specified add or subtract, and then saturate the result to the signed range -2n–1 ≤ x ≤ 2n–1-1, where *x* is given by the number of bits applied in the instruction, 32, 16 or 8.

If the returned result is different from the value to be saturated, it is called saturation. If saturation occurs, the QADD and QSUB instructions set the APSR Q flag to 1. Otherwise, Q flag is unchanged. The 8-bit and 16-bit QADD and QSUB instructions always leave Q flag unchanged.

To clear the Q flag to 0, you must use the MSR instruction, see *MSR on page 187*. To read the state of the Q flag, use the MRS instruction, see *MRS on page 186*.

## **Restrictions**

Do not use SP and do not use PC.

Condition flags

These instructions do not affect the condition code flags. If saturation occurs, these instructions set the Q flag to 1.

## **Examples**

```
QADD16 R7, R4, R2 ; Adds halfwords of R4 with corresponding halfword of
                  ; R2, saturates to 16 bits and writes to corresponding
                  ; halfword of R7
QADD8 R3, R1, R6 ; Adds bytes of R1 to corresponding bytes of R6,saturates
                  ; to 8 bits and writes to corresponding byte of R3
QSUB16 R4, R2, R3 ; Subtracts halfwords of R3 from corresponding halfword
```

![](_page_3_Picture_29.jpeg)

```
; of R2, saturates to 16 bits, writes to corresponding
                  ; halfword of R4
QSUB8 R4, R2, R5 ; Subtracts bytes of R5 from the corresponding byte in R2
                  ; saturates to 8 bits, writes to corresponding byte ofR4.
```

## <span id="page-4-0"></span>**3.7.4 QASX and QSAX**

Saturating Add and Subtract with Exchange and Saturating Subtract and Add with Exchange, signed.

## **Syntax**

```
op{cond} {Rd}, Rm, Rn
```

#### Where:

- *op'* is one of:
  - QASX Add and Subtract with Exchange and Saturate.
  - QSAX Subtract and Add with Exchange and Saturate.
- '*cond*' is an optional condition code (see *Conditional execution on page 65*)
- '*Rd*' is the destination register.
- '*Rn, Rm*' are registers holding the first and second operands.

## **Operation**

The QASX instruction:

- 1. Adds the top halfword of the source operand with bottom halfword of second operand.
- 2. Subtracts the top halfword of second operand from bottom highword of first operand.
- 3. Saturates the result of the subtraction and writes a 16-bit signed integer in the range 215 ≤ x ≤ 215 – 1, where *x* equals 16, to the bottom halfword of the destination register.
- 4. Saturates the results of the sum and writes a 16-bit signed integer in the range
- 5. –215 ≤ x ≤ 215 1, where *x* equals 16, to the top halfword of the destination register.

#### The QSAX instruction:

- 1. Subtracts the bottom halfword of second operand from top highword of first operand.
- 2. Adds the bottom halfword of source operand with top halfword of second operand.
- 3. Saturates the results of the sum and writes a 16-bit signed integer in the range
- 4. –215 ≤ x ≤ 215 1, where *x* equals 16, to the bottom halfword of the destination register.
- 5. Saturates the result of the subtraction and writes a 16-bit signed integer in the range 215 ≤ x ≤ 215 – 1, where *x* equals 16, to the top halfword of the destination register.

## **Restrictions**

Do not use SP and do not use PC.

Condition flags

These instructions do not affect the condition code flags.

## **Examples**

```
QASX R7, R4, R2 ; Adds top halfword of R4 to bottom halfword of R2,
                 ; saturates to 16 bits, writes to top halfword of R7
```

![](_page_4_Picture_33.jpeg)

PM0214 Rev 10 129/262

```
; Subtracts top highword of R2 from bottom halfword of 
                  ; R4, saturates to 16 bits and writes to bottom halfword
                  ; of R7
QSAX R0, R3, R5 ; Subtracts bottom halfword of R5 from top halfword of
                  ; R3, saturates to 16 bits, writes to top halfword of R0
                  ; Adds bottom halfword of R3 to top halfword of R5,
                  ; saturates to 16 bits, writes to bottom halfword of R0.
```

# <span id="page-5-0"></span>**3.7.5 QDADD and QDSUB**

Saturating Double and Add and Saturating Double and Subtract, signed.

## **Syntax**

```
op{cond} {Rd}, Rm, Rn
```

#### Where:

• *op'* is one of:

QDADD Saturating Double and Add.

QDSUB Saturating Double and Subtract.

- '*cond*' is an optional condition code (see *Conditional execution on page 65*)
- '*Rd*' is the destination register.
- '*Rn, Rm*' are registers holding the first and second operands.

## **Operation**

The QDADD instruction:

- 1. Doubles the second operand value.
- 2. Adds the result of the doubling to the signed saturated value in the first operand.
- 3. Writes the result to the destination register.

The QDSUB instruction:

- 1. Doubles the second operand value.
- 2. Subtracts the doubled value from the signed saturated value in the first operand.
- 3. Writes the result to the destination register.

Both the doubling and the addition or subtraction have their results saturated to the 32-bit signed integer range –2<sup>31</sup> ≤ x ≤ 231– 1. If saturation occurs in either operation, it sets the Q flag in the APSR.

# **Restrictions**

Do not use SP and do not use PC.

Condition flags

If saturation occurs, these instructions set the Q flag to 1.

## **Examples**

```
QDADD R7, R4, R2 ; Doubles and saturates R4 to 32 bits, adds R2,
                    ; saturates to 32 bits, writes to R7
QDSUB R0, R3, R5 ; Subtracts R3 doubled and saturated to 32 bits
```

![](_page_5_Picture_31.jpeg)

; from R5, saturates to 32 bits, writes to R0.

## <span id="page-6-0"></span>**3.7.6 UQASX and UQSAX**

Saturating Add and Subtract with Exchange and Saturating Subtract and Add with Exchange, unsigned.

## **Syntax**

```
op{cond} {Rd}, Rm, Rn
```

### Where:

- *op'* is one of:
  - UQASX Add and Subtract with Exchange and Saturate.
  - UQSAX Subtract and Add with Exchange and Saturate.
- '*cond*' is an optional condition code (see *Conditional execution on page 65*)
- '*Rd*' is the destination register.
- '*Rn, Rm*' are registers holding the first and second operands.

## **Operation**

#### The UQASX instruction:

- 1. Adds the bottom halfword of the source operand with top halfword of second operand.
- 2. Subtracts the bottom halfword of the second operand from the top highword of the first operand.
- 3. Saturates the results of the sum and writes a 16-bit unsigned integer in the range
- 4. 0 ≤ x ≤ 216 1, where *x* equals 16, to the top halfword of the destination register.
- 5. Saturates the result of the subtraction and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the bottom halfword of the destination register.

#### The UQSAX instruction:

- 1. Subtracts the bottom halfword of second operand from top highword of first operand.
- 2. Adds the bottom halfword of the first operand with the top halfword of the second operand.
- 3. Saturates the result of the subtraction and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the top halfword of the destination register.
- 4. Saturates the results of the addition and writes a 16-bit unsigned integer in the range 0 ≤ x ≤ 216 – 1, where *x* equals 16, to the bottom halfword of the destination register.

# **Restrictions**

Do not use SP and do not use PC.

## **Condition flags**

These instructions do not affect the condition code flags.

## **Examples**

```
UQASX R7, R4, R2 ; Adds top halfword of R4 with bottom halfword of R2, 
               ; saturates to 16 bits, writes to top halfword of R7
               ; Subtracts top halfword of R2 from bottom halfword of
```

PM0214 Rev 10 131/262

```
; R4, saturates to 16 bits, writes to bottom halfword of R7
UQSAX R0, R3, R5 ; Subtracts bottom halfword of R5 from top halfword of
               ; R3, saturates to 16 bits, writes to top halfword of R0
               ; Adds bottom halfword of R4 to top halfword of R5
               ; saturates to 16 bits, writes to bottom halfword of R0.
```

## <span id="page-7-0"></span>**3.7.7 UQADD and UQSUB**

Saturating Add and Saturating Subtract Unsigned.

## **Syntax**

```
op{cond} {Rd}, Rn, Rm
op{cond} {Rd}, Rn, Rm
```

#### Where:

• *op'* is one of:

UQADD8 Saturating four unsigned 8-bit integer additions.

UQADD16 Saturating two unsigned 16-bit integer additions.

UDSUB8 Saturating four unsigned 8-bit integer subtractions.

UQSUB16 Saturating two unsigned 16-bit integer subtractions.

- '*cond*' is an optional condition code (see *Conditional execution on page 65*)
- '*Rd*' is the destination register.
- '*Rn, Rm*' are registers holding the first and second operands.

## **Operation**

These instructions add or subtract two or four values and then writes an unsigned saturated value in the destination register.

## The UQADD16 instruction:

- 1. Adds the respective top and bottom halfwords of the first and second operands.
- 2. Saturates the result of the additions for each halfword in the destination register to the unsigned range 0 ≤ x ≤ 216-1, where *x* is 16.

# The UQADD8 instruction:

- 1. Adds each respective byte of the first and second operands.
- 2. Saturates the result of the addition for each byte in the destination register to the unsigned range 0 ≤ x ≤ 28-1, where *x* is 8.

#### The UQSUB16 instruction:

- 1. Subtracts both halfwords of the second operand from the respective halfwords of the first operand.
- 2. Saturates the result of the differences in the destination register to the unsigned range 0 ≤ x ≤ 216-1, where *x* is 16.

#### The UQSUB8 instructions:

- 1. Subtracts the respective bytes of the second operand from the respective bytes of the first operand.
- 2. Saturates the results of the differences for each byte in the destination register to the unsigned range 0 ≤ x ≤ 28-1, where *x* is 8.

![](_page_7_Picture_31.jpeg)

## **Restrictions**

Do not use SP and do not use PC.

Condition flags

These instructions do not affect the condition code flags.

## **Examples**

```
UQADD16 R7, R4, R2; Adds halfwords in R4 to corresponding halfword in R2, 
                  ; saturates to 16 bits, writes to corresponding halfword
                  ; of R7
UQADD8 R4, R2, R5 ; Adds bytes of R2 to corresponding byte of R5, saturates
                  ; to 8 bits, writes to corresponding bytes of R4
UQSUB16 R6, R3, R0 ; Subtracts halfwords in R0 from corresponding halfword
                  ; in R3, saturates to 16 bits, writes to corresponding
                  ; halfword in R6
UQSUB8 R1, R5, R6 ; Subtracts bytes in R6 from corresponding byte of R5, 
                  ; saturates to 8 bits, writes to corresponding byte of 
R1.
```

![](_page_8_Picture_8.jpeg)

PM0214 Rev 10 133/262