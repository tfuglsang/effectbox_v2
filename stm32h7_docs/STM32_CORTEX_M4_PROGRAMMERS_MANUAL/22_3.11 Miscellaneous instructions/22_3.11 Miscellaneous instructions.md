# **3.11 Miscellaneous instructions**

*[Table 36](#page-0-0)* shows the remaining Cortex-M4 instructions:

**Table 36. Miscellaneous instructions** 

<span id="page-0-0"></span>

| Mnemonic | Brief description                          | See              |
|----------|--------------------------------------------|------------------|
| BKPT     | Breakpoint                                 | BKPT on page 181 |
| CPSID    | Change Processor State, Disable Interrupts | CPS on page 182  |
| CPSIE    | Change Processor State, Enable Interrupts  | CPS on page 182  |
| DMB      | Data Memory Barrier                        | DMB on page 183  |
| DSB      | Data Synchronization Barrier               | DSB on page 184  |
| ISB      | Instruction Synchronization Barrier        | ISB on page 185  |
| MRS      | Move from special register to register     | MRS on page 186  |
| MSR      | Move from register to special register     | MSR on page 187  |
| NOP      | No Operation                               | NOP on page 188  |
| SEV      | Send Event                                 | SEV on page 189  |
| SVC      | Supervisor Call                            | SVC on page 190  |
| WFE      | Wait For Event                             | WFE on page 191  |
| WFI      | Wait For Interrupt                         | WFI on page 192  |

![](_page_0_Picture_6.jpeg)

## <span id="page-1-0"></span>**3.11.1 BKPT**

Breakpoint.

### **Syntax**

BKPT #*imm*

#### Where:

• '*imm'* is an expression evaluating to an integer in the range 0-255 (8-bit value).

#### **Operation**

The BKPT instruction causes the processor to enter Debug state. Debug tools can use this to investigate system state when the instruction at a particular address is reached.

*imm* is ignored by the processor. If required, a debugger can use it to store additional information about the breakpoint.

The BKPT instruction can be placed inside an IT block, but it executes unconditionally, unaffected by the condition specified by the IT instruction.

### **Condition flags**

This instruction does not change the flags.

#### **Examples**

```
 BKPT 0xAB ; Breakpoint with immediate value set to 0xAB (debugger can
 ; extract the immediate value by locating it using the PC)
```

![](_page_1_Picture_16.jpeg)

PM0214 Rev 10 181/262

## <span id="page-2-0"></span>**3.11.2 CPS**

Change processor state.

#### **Syntax**

```
CPSeffect iflags
```

#### Where:

- *'effect'* is one of:
  - IE: Clears the special purpose register.
  - ID: Sets the special purpose register.
- *'iflags'* is a sequence of one or more flags:
  - i: Set or clear PRIMASK.
  - f: Set or clear FAULTMASK.

## **Operation**

CPS changes the PRIMASK and FAULTMASK special register values. See *Exception mask registers on page 23* for more information about these registers.

#### **Restrictions**

The restrictions are:

- Use CPS only from privileged software, it has no effect if used in unprivileged software
- CPS cannot be conditional and so must not be used inside an IT block.

#### **Condition flags**

This instruction does not change the condition flags.

#### **Examples**

```
CPSID i ; Disable interrupts and configurable fault handlers (set PRIMASK)
CPSID f ; Disable interrupts and all fault handlers (set FAULTMASK)
CPSIE i ; Enable interrupts and configurable fault handlers(clear PRIMASK)
CPSIE f ; Enable interrupts and fault handlers (clear FAULTMASK)
```

![](_page_2_Picture_24.jpeg)

## <span id="page-3-0"></span>**3.11.3 DMB**

Data memory barrier.

#### **Syntax**

DMB{*cond*}

Where: *'cond'* is an optional condition code, see *Conditional execution on page 65*.

### **Operation**

DMB acts as a data memory barrier. It ensures that all explicit memory accesses that appear, in program order, before the DMB instruction are completed before any explicit memory accesses that appear, in program order, after the DMB instruction. DMB does not affect the ordering or execution of instructions that do not access memory.

### **Condition flags**

This instruction does not change the flags.

#### **Examples**

DMB ; Data Memory Barrier

![](_page_3_Picture_13.jpeg)

PM0214 Rev 10 183/262

## <span id="page-4-0"></span>**3.11.4 DSB**

Data synchronization barrier.

### **Syntax**

DSB{*cond*}

Where: *'cond'* is an optional condition code, see *Conditional execution on page 65*.

### **Operation**

DSB acts as a special data synchronization memory barrier. Instructions that come after the DSB, in program order, do not execute until the DSB instruction completes. The DSB instruction completes when all explicit memory accesses before it complete.

#### **Condition flags**

This instruction does not change the flags.

#### **Examples**

DSB ; Data Synchronisation Barrier

![](_page_4_Picture_13.jpeg)

## <span id="page-5-0"></span>**3.11.5 ISB**

Instruction synchronization barrier.

### **Syntax**

ISB{*cond*}

Where: *'cond'* is an optional condition code, see *Conditional execution on page 65*.

### **Operation**

ISB acts as an instruction synchronization barrier. It flushes the pipeline of the processor, so that all instructions following the ISB are fetched from cache or memory again, after the ISB instruction is completed.

#### **Condition flags**

This instruction does not change the flags.

#### **Examples**

ISB ; Instruction Synchronisation Barrier

![](_page_5_Picture_13.jpeg)

PM0214 Rev 10 185/262

### <span id="page-6-0"></span>**3.11.6 MRS**

Move the contents of a special register to a general-purpose register.

### **Syntax**

MRS{*cond*} *Rd*, *spec\_reg*

#### Where:

- *'cond'* is an optional condition code, see *Conditional execution on page 65*.
- *'Rd'* is the destination register.
- *'spec\_reg'* can be any of: APSR, IPSR, EPSR, IEPSR, IAPSR, EAPSR, PSR, MSP, PSP, PRIMASK, BASEPRI, BASEPRI\_MAX, FAULTMASK, or CONTROL.

#### **Operation**

Use MRS in combination with MSR as part of a read-modify-write sequence for updating a PSR, for example to clear the Q flag. See *[MSR on page 187](#page-7-0)*.

In process swap code, the programmers model state of the process being swapped out must be saved, including relevant PSR contents. Similarly, the state of the process being swapped in must also be restored. These operations use MRS in the state-saving instruction sequence and MSR in the state-restoring instruction sequence. BASEPRI\_MAX is an alias of BASEPRI when used with the MRS instruction.

### **Restrictions**

*Rd* must not be SP and must not be PC.

### **Condition flags**

This instruction does not change the flags.

#### **Examples**

MRS R0, PRIMASK ; Read PRIMASK value and write it to R0

## <span id="page-7-0"></span>**3.11.7 MSR**

Move the contents of a general-purpose register into the specified special register.

### **Syntax**

MSR{*cond*} *spec\_reg*, *Rn*

#### Where:

- *'cond'* is an optional condition code, see *Conditional execution on page 65*.
- *'Rn'* is the source register.
- *'spec\_reg'* can be any of: APSR, IPSR, EPSR, IEPSR, IAPSR, EAPSR, PSR, MSP, PSP, PRIMASK, BASEPRI, BASEPRI\_MAX, FAULTMASK, or CONTROL.

#### **Operation**

The register access operation in MSR depends on the privilege level. Unprivileged software can only access the APSR, see *Table 5: APSR bit definitions on page 21*. Privileged software can access all special registers.

In unprivileged software writes to unallocated or execution state bits in the PSR are ignored.

When you write to BASEPRI\_MAX, the instruction writes to BASEPRI only if either:

- *Rn* is non-zero and the current BASEPRI value is 0
- *Rn* is non-zero and less than the current BASEPRI value.

See *[MRS on page 186](#page-6-0)*.

#### **Restrictions**

*Rn* must not be SP and must not be PC.

#### **Condition flags**

This instruction updates the flags explicitly based on the value in *Rn*.

#### **Examples**

MSR CONTROL, R1 ; Read R1 value and write it to the CONTROL register

PM0214 Rev 10 187/262

## <span id="page-8-0"></span>**3.11.8 NOP**

No Operation.

### **Syntax**

NOP{*cond*}

#### Where:

• *'cond'* is an optional condition code, see *Conditional execution on page 65*.

#### **Operation**

NOP does nothing. NOP is not necessarily a time-consuming NOP. The processor might remove it from the pipeline before it reaches the execution stage.

Use NOP for padding, for example to place the following instruction on a 64-bit boundary.

#### **Condition flags**

This instruction does not change the flags.

### **Examples**

NOP ; No operation

![](_page_8_Picture_15.jpeg)

## <span id="page-9-0"></span>**3.11.9 SEV**

Send Event.

#### **Syntax**

SEV{*cond*}

#### Where:

• *'cond'* is an optional condition code, see *Conditional execution on page 65*.

#### **Operation**

SEV is a hint instruction that causes an event to be signaled to all processors within a multiprocessor system. It also sets the local event register to 1, see *Power management on page 47*.

#### **Condition flags**

This instruction does not change the flags.

#### **Examples**

SEV ; Send Event

![](_page_9_Picture_14.jpeg)

PM0214 Rev 10 189/262

## <span id="page-10-0"></span>**3.11.10 SVC**

Supervisor Call.

#### **Syntax**

```
SVC{cond} #imm
```

#### Where:

- *'cond'* is an optional condition code, see *Conditional execution on page 65*.
- *'imm'* is an expression evaluating to an integer in the range 0-255 (8-bit value).

#### **Operation**

The SVC instruction causes the SVC exception. *imm* is ignored by the processor. If required, it can be retrieved by the exception handler to determine what service is being requested.

#### **Condition flags**

This instruction does not change the flags.

#### **Examples**

```
 SVC 0x32 ; Supervisor Call (SVC handler can extract the immediate 
value
 ; by locating it via the stacked PC)
```

## <span id="page-11-0"></span>**3.11.11 WFE**

Wait For Event. WFE is a hint instruction.

## **Syntax**

WFE{*cond*}

Where: *'cond'* is an optional condition code, see *Conditional execution on page 65*.

### **Operation**

If the event register is 0, WFE suspends execution until one of the following events occurs:

- An exception, unless masked by exception mask registers or the current priority level
- An exception enters Pending state, if SEVONPEND in System Control Register is set
- A Debug Entry request, if Debug is enabled
- An event signaled by a peripheral or another processor in a multiprocessor system using the SEV instruction.

If the event register is 1, WFE clears it to 0 and returns immediately.

For more information see *Power management on page 47*.

#### **Condition flags**

This instruction does not change the flags.

### **Examples**

WFE ; Wait for event

![](_page_11_Picture_19.jpeg)

PM0214 Rev 10 191/262

## <span id="page-12-0"></span>**3.11.12 WFI**

Wait for Interrupt.

### **Syntax**

WFI{*cond*}

#### Where:

• *'cond'* is an optional condition code, see *Conditional execution on page 65*.

### **Operation**

WFI is a hint instruction that suspends execution until one of the following events occurs:

- An exception
- A Debug Entry request, regardless of whether Debug is enabled.

#### **Condition flags**

This instruction does not change the flags.

#### **Examples**

WFI ; Wait for interrupt