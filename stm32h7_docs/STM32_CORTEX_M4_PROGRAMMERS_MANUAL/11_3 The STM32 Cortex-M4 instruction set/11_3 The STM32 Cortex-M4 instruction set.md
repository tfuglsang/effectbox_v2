# **3 The STM32 Cortex-M4 instruction set**

This chapter is the reference material for the Cortex-M4 instruction set description in a User Guide. The following sections give general information:

*[Section 3.1: Instruction set summary on page 50](#page-0-0)*

*Section 3.2: CMSIS intrinsic functions on page 58*

*Section 3.3: About the instruction descriptions on page 60*

Each of the following sections describes a functional group of Cortex-M4 instructions. Together they describe all the instructions supported by the Cortex-M4 processor:

*Section 3.4: Memory access instructions on page 69*

*Section 3.5: General data processing instructions on page 81*

*Section 3.6: Multiply and divide instructions on page 109*

*Section 3.7: Saturating instructions on page 125*

*Section 3.8: Packing and unpacking instructions on page 134*

*Section 3.9: Bitfield instructions on page 138*

*Section 3.10: Floating-point instructions on page 149*

*Section 3.11: Miscellaneous instructions on page 180*

## <span id="page-0-0"></span>**3.1 Instruction set summary**

The processor implements a version of the thumb instruction set. *[Table 21](#page-0-1)* lists the supported instructions.

### In *[Table 21](#page-0-1)*:

- Angle brackets, <>, enclose alternative forms of the operand.
- Braces, {}, enclose optional operands.
- The operands column is not exhaustive.
- Op2 is a flexible second operand that can be either a register or a constant.
- Most instructions can use an optional condition code suffix.

For more information on the instructions and operands, see the instruction descriptions.

<span id="page-0-1"></span>**Mnemonic Operands Brief description Flags Page** ADC, ADCS {Rd,} Rn, Op2 Add with carry N,Z,C,V *3.5.1 on page 83* ADD, ADDS {Rd,} Rn, Op2 Add N,Z,C,V *3.5.1 on page 83* ADD, ADDW {Rd,} Rn, #imm12 Add N,Z,C,V *3.5.1 on page 83* ADR Rd, label Load PC-relative address â€” *3.4.1 on page 70*

**Table 21. Cortex-M4 instructions** 

50/262 PM0214 Rev 10

![](_page_0_Picture_28.jpeg)

#### **Wakeup from WFE**

The processor wakes up if:

- it detects an exception with sufficient priority to cause exception entry
- it detects an external event signal, see *[Section 2.5.3: External event input / extended](#page-1-0)  [interrupt and event input](#page-1-0)*
- in a multiprocessor system, another processor in the system executes an SEV instruction.

In addition, if the SEVONPEND bit in the SCR is set to 1, any new pending interrupt triggers an event and wakes up the processor, even if the interrupt is disabled or has insufficient priority to cause exception entry. For more information about the SCR see *System control register (SCR) on page 230*.

## <span id="page-1-0"></span>**2.5.3 External event input / extended interrupt and event input**

The processor provides an external event input signal.

This signal is generated by the External or Extended Interrupt/event Controller (EXTI) on asynchronous event detection (from external input pins or asynchronous peripheral event).

This signal can wakeup the processor from WFE, or set the internal WFE event register to one to indicate that the processor must not enter sleep mode on a later WFE instruction, as described in *Wait for event on page 48*. Fore more details please refer to the STM32 reference manual, Low power modes section.

## **2.5.4 Power management programming hints**

ISO/IEC C cannot directly generate the WFI and WFE instructions. The CMSIS provides the following functions for these instructions:

```
void __WFE(void) // Wait for Event
void __WFI(void) // Wait for Interrupt
```

![](_page_1_Picture_15.jpeg)

PM0214 Rev 10 49/262