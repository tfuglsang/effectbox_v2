**Core peripherals PM0214**

# **4.5 SysTick timer (STK)**

The processor has a 24-bit system timer, SysTick, that counts down from the reload value to zero, reloads (wraps to) the value in the STK\_LOAD register on the next clock edge, then counts down on subsequent clocks.

When the processor is halted for debugging the counter does not decrement.

**Table 54. System timer registers summary**

| Address    | Name      | Type | Required<br>privilege | Reset value | Description                                                   |
|------------|-----------|------|-----------------------|-------------|---------------------------------------------------------------|
| 0xE000E010 | STK_CTRL  | RW   | Privileged            | 0x00000000  | SysTick control and status register (STK_CTRL)<br>on page 247 |
| 0xE000E014 | STK_LOAD  | RW   | Privileged            | Unknown     | SysTick reload value register (STK_LOAD) on<br>page 248       |
| 0xE000E018 | STK_VAL   | RW   | Privileged            | Unknown     | SysTick current value register (STK_VAL) on<br>page 249       |
| 0xE000E01C | STK_CALIB | RO   | Privileged            | 0xC0000000  | SysTick calibration value register (STK_CALIB)<br>on page 250 |

246/262 PM0214 Rev 10

**PM0214 Core peripherals**

### <span id="page-1-0"></span>**4.5.1 SysTick control and status register (STK\_CTRL)**

Address offset: 0x00

Reset value: 0x0000 0000 Required privilege: Privileged

The SysTick CTRL register enables the SysTick features.

| 31                                       | 30 | 29 | 28 | 27 | 26 | 25 | 24       | 23 | 22 | 21 | 20 | 19 | 18 | 17 | 16            |
|------------------------------------------|----|----|----|----|----|----|----------|----|----|----|----|----|----|----|---------------|
|                                          |    |    |    |    |    |    | Reserved |    |    |    |    |    |    |    | COUNT<br>FLAG |
|                                          |    |    |    |    |    |    |          |    |    |    |    |    |    |    | rw            |
| 15                                       | 14 | 13 | 12 | 11 | 10 | 9  | 8        | 7  | 6  | 5  | 4  | 3  | 2  | 1  | 0             |
| CLKSO<br>TICK<br>URCE<br>INT<br>Reserved |    |    |    |    |    |    |          |    |    |    |    |    |    |    | EN<br>ABLE    |
|                                          |    |    |    |    |    |    |          |    |    |    |    |    | rw | rw | rw            |

Bits 31:17 Reserved, must be kept cleared.

#### Bit 16 COUNTFLAG:

**Returns 1 if timer counted to 0 since last time this was read.**

Bits 15:3 Reserved, must be kept cleared.

Bit 2 **CLKSOURCE:** Clock source selection

Selects the clock source.

0: AHB/8

1: Processor clock (AHB)

Bit 1 **TICKINT**: SysTick exception request enable

0: Counting down to zero does not assert the SysTick exception request

1: Counting down to zero to asserts the SysTick exception request.

*Note: Software can use COUNTFLAG to determine if SysTick has ever counted to zero.*

### Bit 0 **ENABLE**: Counter enable

Enables the counter. When ENABLE is set to 1, the counter loads the RELOAD value from the LOAD register and then counts down. On reaching 0, it sets the COUNTFLAG to 1 and optionally asserts the SysTick depending on the value of TICKINT. It then loads the RELOAD value again, and begins counting.

0: Counter disabled

1: Counter enabled

**Core peripherals PM0214**

### <span id="page-2-0"></span>**4.5.2 SysTick reload value register (STK\_LOAD)**

Address offset: 0x04

Reset value: 0x0000 0000 Required privilege: Privileged

| 31 | 30 | 29 | 28 | 27       | 26 | 25     | 24 | 23           | 22 | 21 | 20 | 19            | 18 | 17 | 16 |
|----|----|----|----|----------|----|--------|----|--------------|----|----|----|---------------|----|----|----|
|    |    |    |    |          |    |        |    |              |    |    |    | RELOAD[23:16] |    |    |    |
|    |    |    |    | Reserved |    |        |    | rw           | rw | rw | rw | rw            | rw | rw | rw |
| 15 | 14 | 13 | 12 | 11       | 10 | 9<br>8 |    | 7            | 6  | 5  | 4  | 3             | 2  | 1  | 0  |
|    |    |    |    |          |    |        |    | RELOAD[15:0] |    |    |    |               |    |    |    |
| rw | rw | rw | rw | rw       | rw | rw     | rw | rw           | rw | rw | rw | rw            | rw | rw | rw |

Bits 31:24 Reserved, must be kept cleared.

#### Bits 23:0 **RELOAD:** RELOAD value

The LOAD register specifies the start value to load into the STK\_VAL register when the counter is enabled and when it reaches 0.

Calculating the RELOAD value

The RELOAD value can be any value in the range 0x00000001-0x00FFFFFF. A start value of 0 is possible, but has no effect because the SysTick exception request and COUNTFLAG are activated when counting from 1 to 0.

The RELOAD value is calculated according to its use:

- l To generate a multi-shot timer with a period of N processor clock cycles, use a RELOAD value of N-1. For example, if the SysTick interrupt is required every 100 clock pulses, set RELOAD to 99.
- l To deliver a single SysTick interrupt after a delay of N processor clock cycles, use a RELOAD of value N. For example, if a SysTick interrupt is required after 100 clock pulses, set RELOAD to 99.

**PM0214 Core peripherals**

# <span id="page-3-0"></span>**4.5.3 SysTick current value register (STK\_VAL)**

Address offset: 0x08

Reset value: 0x0000 0000 Required privilege: Privileged

| 31 | 30       | 29 | 28 | 27 | 26 | 25 | 24 | 23             | 22 | 21 | 20 | 19 | 18 | 17 | 16 |  |  |  |  |
|----|----------|----|----|----|----|----|----|----------------|----|----|----|----|----|----|----|--|--|--|--|
|    |          |    |    |    |    |    |    | CURRENT[23:16] |    |    |    |    |    |    |    |  |  |  |  |
|    | Reserved |    |    |    |    |    |    |                | rw | rw | rw | rw | rw | rw | rw |  |  |  |  |
| 15 | 14       | 13 | 12 | 11 | 10 | 9  | 8  | 7              | 6  | 5  | 4  | 3  | 2  | 1  | 0  |  |  |  |  |
|    |          |    |    |    |    |    |    | CURRENT[15:0]  |    |    |    |    |    |    |    |  |  |  |  |
| rw | rw       | rw | rw | rw | rw | rw | rw | rw             | rw | rw | rw | rw | rw | rw | rw |  |  |  |  |

Bits 31:24 Reserved, must be kept cleared.

Bits 23:0 **CURRENT:** Current counter value

The VAL register contains the current value of the SysTick counter.

Reads return the current value of the SysTick counter.

A write of any value clears the field to 0, and also clears the COUNTFLAG bit in the

STK\_CTRL register to 0.

**Core peripherals PM0214**

### <span id="page-4-0"></span>**4.5.4 SysTick calibration value register (STK\_CALIB)**

Address offset: 0x0C Reset value: 0x0000000

Required privilege: Privileged

The CALIB register indicates the SysTick calibration properties.

| 31        | 30   | 29 | 28 | 27 | 26       | 25 | 24           | 23          | 22 | 21 | 20 | 19 | 18 | 17 | 16 |  |  |
|-----------|------|----|----|----|----------|----|--------------|-------------|----|----|----|----|----|----|----|--|--|
| NO<br>REF | SKEW |    |    |    | Reserved |    | TENMS[23:16] |             |    |    |    |    |    |    |    |  |  |
| r         | r    |    |    |    |          |    |              | r           | r  | r  | r  | r  | r  |    |    |  |  |
| 15        | 14   | 13 | 12 | 11 | 10       | 9  | 8            | 7           | 6  | 5  | 4  | 3  | 2  | 1  | 0  |  |  |
|           |      |    |    |    |          |    |              | TENMS[15:0] |    |    |    |    |    |    |    |  |  |
| r         | r    | r  | r  | r  | r        | r  | r            | r           | r  | r  | r  | r  | r  | r  | r  |  |  |

- Bit 31 **NOREF:** NOREF flag. Reads as zero. Indicates that a separate reference clock is provided. The frequency of this clock is HCLK/8.
- Bit 30 **SKEW:** SKEW flag: Indicates whether the TENMS value is exact. Reads as one. Calibration value for the 1 ms inexact timing is not known because TENMS is not known. This can affect the suitability of SysTick as a software real time clock.
- Bits 29:24 Reserved, must be kept cleared.
- Bits 23:0 **TENMS[23:0]:** Calibration value. Indicates the calibration value when the SysTick counter runs on HCLK max/8 as external clock. The value is product dependent, please refer to the Product Reference Manual, SysTick Calibration Value section. When HCLK is programmed at the maximum frequency, the SysTick period is 1ms.

If calibration information is not known, calculate the calibration value required from the frequency of the processor clock or external clock.

## **4.5.5 SysTick design hints and tips**

The SysTick counter runs on the processor clock. If this clock signal is stopped for low power mode, the SysTick counter stops.

Ensure software uses aligned word accesses to access the SysTick registers.

The SysTick counter reload and current value are undefined at reset, the correct initialization sequence for the SysTick counter is:

- 1. Program reload value.
- 2. Clear current value.
- 3. Program Control and Status register.

250/262 PM0214 Rev 10

**PM0214 Core peripherals**

### **4.5.6 SysTick register map**

The table provided shows the SysTick register map and reset values. The base address of the SysTick register block is 0xE000 E010.

**Table 55. SysTick register map and reset values** 

| Offset | Register    | 31       | 30       | 29 | 28 | 27 | 26                                                                                                    | 25 | 24           | 23 | 22 | 21 | 20 | 19 | 18     |        | 17<br>16 | 15            | 14          | 13 | 12 | 11 | 10 | 9 | 8        | 7 | 6 | 5 | 4 | 3 | 2         | 1        | 0       |
|--------|-------------|----------|----------|----|----|----|-------------------------------------------------------------------------------------------------------|----|--------------|----|----|----|----|----|--------|--------|----------|---------------|-------------|----|----|----|----|---|----------|---|---|---|---|---|-----------|----------|---------|
| 0x00   | STK_CTRL    |          | Reserved |    |    |    |                                                                                                       |    |              |    |    |    |    |    |        |        |          |               |             |    |    |    |    |   | Reserved |   |   |   |   |   | CLKSOURCE | TICK INT | EN ABLE |
|        | Reset Value |          |          |    |    |    |                                                                                                       |    |              |    | 0  |    |    |    |        |        |          |               |             |    | 1  | 0  | 0  |   |          |   |   |   |   |   |           |          |         |
|        | STK_LOAD    |          |          |    |    |    |                                                                                                       |    | RELOAD[23:0] |    |    |    |    |    |        |        |          |               |             |    |    |    |    |   |          |   |   |   |   |   |           |          |         |
| 0x04   | Reset Value | Reserved |          |    |    |    |                                                                                                       | 0  | 0            | 0  | 0  | 0  | 0  |    | 0<br>0 | 0      | 0        | 0             | 0           | 0  | 0  | 0  | 0  | 0 | 0        | 0 | 0 | 0 | 0 | 0 | 0         |          |         |
|        | STK_VAL     |          |          |    |    |    |                                                                                                       |    |              |    |    |    |    |    |        |        |          | CURRENT[23:0] |             |    |    |    |    |   |          |   |   |   |   |   |           |          |         |
| 0x08   | Reset Value | Reserved |          |    |    |    |                                                                                                       |    | 0            | 0  | 0  | 0  | 0  | 0  |        | 0<br>0 | 0        | 0             | 0           | 0  | 0  | 0  | 0  | 0 | 0        | 0 | 0 | 0 | 0 | 0 | 0         | 0        |         |
| 0x0C   | STK_CALIB   |          |          |    |    |    |                                                                                                       |    |              |    |    |    |    |    |        |        |          |               | TENMS[23:0] |    |    |    |    |   |          |   |   |   |   |   |           |          |         |
|        | Reset Value |          | Reserved |    |    |    | 0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0<br>0 |    |              |    |    |    |    |    | 0      | 0      | 0        |               |             |    |    |    |    |   |          |   |   |   |   |   |           |          |         |