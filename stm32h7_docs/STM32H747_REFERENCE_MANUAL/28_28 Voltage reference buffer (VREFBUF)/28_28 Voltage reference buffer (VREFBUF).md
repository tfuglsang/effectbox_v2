# **28 Voltage reference buffer (VREFBUF)**

# **28.1 Introduction**

The devices embed a voltage reference buffer which can be used as voltage reference for ADCs, DACs and also as voltage reference for external components through the VREF+ pin.

# **28.2 VREFBUF functional description**

The internal voltage reference buffer supports four voltages(a), which are configured with VRS bits in the VREFBUF\_CSR register:

- VRS = 000: around 2.5 V.
- VRS = 001: around 2.048 V.
- VRS = 010: around 1.8 V.
- VRS = 011: around 1.5 V (ADC and DAC peripherals are not compatible with this reference voltage setting).

The internal voltage reference can be configured in four different modes depending on ENVR and HIZ bits configuration. These modes are provided in the table below:

<span id="page-0-0"></span>**ENVR HIZ VREF buffer configuration** 0 0 VREFBUF buffer off mode: – VREF+ pin pulled-down to VSSA 0 1 External voltage reference mode (default value): – VREFBUF buffer off – VREF+ pin input mode 1 0 Internal voltage reference mode: – VREFBUF buffer on – VREF+ pin connected to VREFBUF buffer output 1 1 Hold mode: – VREF is enable without output buffer, VREF+ pin voltage is hold with the external capacitor – VRR detection disabled and VRR bit keeps last state

**Table 237. VREF buffer modes**

After enabling the VREFBUF by setting ENVR bit and clearing HIZ bit in the VREFBUF\_CSR register, the user must wait until VRR bit is set, meaning that the voltage reference output has reached its expected value.

1114/3556 RM0399 Rev 4

a. The minimum VDDA voltage depends on VRS setting, refer to the product datasheet.

# **28.3 VREFBUF registers**

### **28.3.1 VREFBUF control and status register (VREFBUF\_CSR)**

Address offset: 0x00

Reset value: 0x0000 0002

| 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21       | 20   | 19   | 18   | 17   | 16   |
|------|------|------|------|------|------|------|------|------|------|----------|------|------|------|------|------|
| Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res.     | Res. | Res. | Res. | Res. | Res. |
|      |      |      |      |      |      |      |      |      |      |          |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |          |      |      |      |      |      |
| 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5        | 4    | 3    | 2    | 1    | 0    |
| Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. |      | VRS[2:0] |      | VRR  | Res. | HIZ  | ENVR |

Bits 31:7 Reserved, must be kept at reset value.

#### Bits 6:4 **VRS[2:0]**: Voltage reference scale

These bits select the value generated by the voltage reference buffer.

000: Voltage reference set to 2.5 V 001: Voltage reference set to 2.048 V 010: Voltage reference set to 1.8 V 011: Voltage reference set to 1.5 V

Others: Reserved

*Note: The software can program this bitfield only when the VREFBUF is disabled (ENVR=0).*

#### Bit 3 **VRR:** Voltage reference buffer ready

0: the voltage reference buffer output is not ready.

1: the voltage reference buffer output reached the requested level.

#### Bit 2 Reserved, must be kept at reset value.

#### Bit 1 **HIZ:** High impedance mode

This bit controls the analog switch to connect or not the VREF+ pin.

0: VREF+ pin is internally connected to the voltage reference buffer output.

1: VREF+ pin is high impedance.

Refer to *[Table 237: VREF buffer modes](#page-0-0)* for the mode descriptions depending on ENVR bit configuration.

#### Bit 0 **ENVR:** Voltage reference buffer mode enable

This bit is used to enable the voltage reference buffer mode.

0: Internal voltage reference mode disable (external voltage reference mode).

1: Internal voltage reference mode (reference buffer enable or hold mode) enable.

### **28.3.2 VREFBUF calibration control register (VREFBUF\_CCR)**

Address offset: 0x04

Reset value: 0x0000 00XX

| 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18        | 17   | 16   |
|------|------|------|------|------|------|------|------|------|------|------|------|------|-----------|------|------|
| Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res.      | Res. | Res. |
|      |      |      |      |      |      |      |      |      |      |      |      |      |           |      |      |
|      |      |      |      |      |      |      |      |      |      |      |      |      |           |      |      |
| 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2         | 1    | 0    |
| Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. |      |      |      | TRIM[5:0] |      |      |

Bits 31:6 Reserved, must be kept at reset value.

#### Bits 5:0 **TRIM[5:0]**: Trimming code

These bits are automatically initialized after reset with the trimming value stored in the flash memory during the production test. Writing into these bits allows the tuning of the internal reference buffer voltage.

*Note: If the user application performs the trimming, the trimming code must start from 000000 to 111111 in ascending order.*

### **28.3.3 VREFBUF register map**

The following table gives the VREFBUF register map and the reset values.

**Table 238. VREFBUF register map and reset values**

| Offset | Register name | 31   | 30   | 29   | 28   | 27   | 26   | 25   | 24   | 23   | 22   | 21   | 20   | 19   | 18   | 17   | 16   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5        | 4 | 3   | 2         | 1   | 0    |
|--------|---------------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|----------|---|-----|-----------|-----|------|
| 0x00   | VREFBUF_CSR   | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. |      | VRS[2:0] |   | VRR | Res.      | HIZ | ENVR |
|        | Reset value   |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      | 0    | 0        | 0 | 0   |           | 1   | 0    |
| 0x04   | VREFBUF_CCR   | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. | Res. |          |   |     | TRIM[5:0] |     |      |
|        | Reset value   |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      | x        | x | x   | x         | x   | x    |

Refer to *Section 2.3* for the register boundary addresses.

1116/3556 RM0399 Rev 4